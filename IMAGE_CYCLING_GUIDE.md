# 🔄 이미지 순환 시스템 가이드

## 🎯 문제 상황
**12개 장면이 필요한데 이미지가 6개만 있다면?**

---

## ✅ 해결 방법: 이미지 순환(Cycling)

### 핵심 아이디어
이미지가 부족하면 **처음부터 다시 반복**하여 사용합니다.

```
이미지: [1, 2, 3, 4, 5, 6]
장면:   [1, 2, 3, 4, 5, 6, 1, 2, 3, 4, 5, 6]
         ↑  반복 시작
```

---

## 🔧 기술적 구현

### 순환 매핑 로직
```javascript
// backend/src/routes/script.js

const imageCount = images?.length || 0;
const sceneCount = 12;

console.log(`📷 이미지 수: ${imageCount}개, 장면 수: ${sceneCount}개`);

// 이미지 매핑 배열 생성
let imageMapping = [];

if (imageCount > 0) {
  if (imageCount >= sceneCount) {
    // 이미지가 충분한 경우: 순서대로 1:1 매핑
    imageMapping = images.slice(0, sceneCount);
    console.log(`✅ 이미지 충분: 1:1 매핑`);
  } else {
    // 이미지가 부족한 경우: 순환 재사용
    for (let i = 0; i < sceneCount; i++) {
      imageMapping.push(images[i % imageCount]);
    }
    console.log(`🔄 이미지 순환: ${imageCount}개 이미지를 ${sceneCount}개 장면에 순환 배치`);
    console.log(`   패턴: ${imageMapping.map((_, idx) => (idx % imageCount) + 1).join(',')}`);
  }
}

// 장면에 이미지 매핑
const scenes = selectedSentences.map((sentence, index) => ({
  sceneNumber: index + 1,
  narration: sentence,
  imageUrl: imageMapping[index] || null,  // 순환 매핑된 이미지
  duration: Math.min(Math.max(Math.ceil(sentence.length / 4), 2.5), 4)
}));
```

---

## 📊 다양한 시나리오

### 시나리오 1: 이미지 6개, 장면 12개
```
입력:
  이미지: [img1, img2, img3, img4, img5, img6]
  장면 수: 12개

순환 패턴:
  장면 1: img1
  장면 2: img2
  장면 3: img3
  장면 4: img4
  장면 5: img5
  장면 6: img6
  ─────── 반복 시작 ───────
  장면 7: img1  (6 % 6 = 0 → img1)
  장면 8: img2  (7 % 6 = 1 → img2)
  장면 9: img3  (8 % 6 = 2 → img3)
  장면 10: img4 (9 % 6 = 3 → img4)
  장면 11: img5 (10 % 6 = 4 → img5)
  장면 12: img6 (11 % 6 = 5 → img6)

출력:
  패턴: 1,2,3,4,5,6,1,2,3,4,5,6
  결과: ✅ 각 이미지가 정확히 2번씩 사용됨
```

---

### 시나리오 2: 이미지 4개, 장면 12개
```
입력:
  이미지: [img1, img2, img3, img4]
  장면 수: 12개

순환 패턴:
  장면 1: img1  (0 % 4 = 0)
  장면 2: img2  (1 % 4 = 1)
  장면 3: img3  (2 % 4 = 2)
  장면 4: img4  (3 % 4 = 3)
  ─────── 1차 반복 ───────
  장면 5: img1  (4 % 4 = 0)
  장면 6: img2  (5 % 4 = 1)
  장면 7: img3  (6 % 4 = 2)
  장면 8: img4  (7 % 4 = 3)
  ─────── 2차 반복 ───────
  장면 9: img1  (8 % 4 = 0)
  장면 10: img2 (9 % 4 = 1)
  장면 11: img3 (10 % 4 = 2)
  장면 12: img4 (11 % 4 = 3)

출력:
  패턴: 1,2,3,4,1,2,3,4,1,2,3,4
  결과: ✅ 각 이미지가 정확히 3번씩 사용됨
```

---

### 시나리오 3: 이미지 3개, 장면 12개
```
입력:
  이미지: [img1, img2, img3]
  장면 수: 12개

순환 패턴:
  장면 1-3: img1, img2, img3
  장면 4-6: img1, img2, img3  (1차 반복)
  장면 7-9: img1, img2, img3  (2차 반복)
  장면 10-12: img1, img2, img3 (3차 반복)

출력:
  패턴: 1,2,3,1,2,3,1,2,3,1,2,3
  결과: ✅ 각 이미지가 정확히 4번씩 사용됨
```

---

### 시나리오 4: 이미지 12개 이상
```
입력:
  이미지: [img1, img2, ..., img15]
  장면 수: 12개

매핑:
  장면 1: img1
  장면 2: img2
  ...
  장면 12: img12

출력:
  패턴: 1,2,3,4,5,6,7,8,9,10,11,12
  결과: ✅ 1:1 매핑 (순환 불필요)
  참고: img13, img14, img15는 사용 안 됨
```

---

### 시나리오 5: 이미지 1개, 장면 12개
```
입력:
  이미지: [img1]
  장면 수: 12개

순환 패턴:
  모든 장면: img1

출력:
  패턴: 1,1,1,1,1,1,1,1,1,1,1,1
  결과: ✅ 동일 이미지 12번 사용
  참고: Ken Burns 효과로 다양성 확보 가능
```

---

## 🎬 로그 출력 예시

### 예시 1: 6개 이미지 순환
```
📷 이미지 수: 6개, 장면 수: 12개
🔄 이미지 순환: 6개 이미지를 12개 장면에 순환 배치
   패턴: 1,2,3,4,5,6,1,2,3,4,5,6

✅ 최종 선택된 나레이션 (12개):
   ⭐ 1. "그램은 가볍죠" (8자) - 이미지 1
   ⭐ 2. "화면이 선명해요" (9자) - 이미지 2
   ⭐ 3. "배터리가 오래가요" (10자) - 이미지 3
   ⭐ 4. "성능도 좋습니다" (9자) - 이미지 4
   ⭐ 5. "가성비 최고예요" (9자) - 이미지 5
   ⭐ 6. "휴대성이 뛰어나요" (10자) - 이미지 6
   🔄 7. "디자인도 세련됐죠" (11자) - 이미지 1 (재사용)
   🔄 8. "타이핑도 편해요" (9자) - 이미지 2 (재사용)
   🔄 9. "영상 편집도 가능" (10자) - 이미지 3 (재사용)
   🔄 10. "업무용으로 최고죠" (11자) - 이미지 4 (재사용)
   🔄 11. "학생들이 좋아해요" (11자) - 이미지 5 (재사용)
   🔄 12. "강력 추천합니다" (9자) - 이미지 6 (재사용)

⏱️  총 영상 길이: 32.5초 (목표: 30초 이상)
✅ 템플릿 기반 스크립트 생성 완료: 12개 장면, 총 32.5초
```

---

### 예시 2: 4개 이미지 순환
```
📷 이미지 수: 4개, 장면 수: 12개
🔄 이미지 순환: 4개 이미지를 12개 장면에 순환 배치
   패턴: 1,2,3,4,1,2,3,4,1,2,3,4

✅ 최종 선택된 나레이션 (12개):
   ⭐ 1-4. ... (이미지 1,2,3,4)
   🔄 5-8. ... (이미지 1,2,3,4 재사용)
   🔄 9-12. ... (이미지 1,2,3,4 재사용)

⏱️  총 영상 길이: 33.0초 (목표: 30초 이상)
✅ 템플릿 기반 스크립트 생성 완료: 12개 장면, 총 33.0초
```

---

### 예시 3: 충분한 이미지 (12개 이상)
```
📷 이미지 수: 15개, 장면 수: 12개
✅ 이미지 충분: 1:1 매핑

✅ 최종 선택된 나레이션 (12개):
   ⭐ 1. "..." - 이미지 1
   ⭐ 2. "..." - 이미지 2
   ...
   ⭐ 12. "..." - 이미지 12

⏱️  총 영상 길이: 34.0초 (목표: 30초 이상)
✅ 템플릿 기반 스크립트 생성 완료: 12개 장면, 총 34.0초
```

---

## 🧮 수학적 계산

### Modulo 연산 (%)
```javascript
// i % imageCount = 이미지 인덱스

예시: imageCount = 6
  0 % 6 = 0 → 이미지 1
  1 % 6 = 1 → 이미지 2
  2 % 6 = 2 → 이미지 3
  3 % 6 = 3 → 이미지 4
  4 % 6 = 4 → 이미지 5
  5 % 6 = 5 → 이미지 6
  6 % 6 = 0 → 이미지 1 (반복!)
  7 % 6 = 1 → 이미지 2
  ...
  11 % 6 = 5 → 이미지 6
```

### 이미지 사용 빈도
```
총 장면 수 ÷ 이미지 수 = 각 이미지 사용 횟수

예시:
  12 ÷ 6 = 2회 (각 이미지 2번씩)
  12 ÷ 4 = 3회 (각 이미지 3번씩)
  12 ÷ 3 = 4회 (각 이미지 4번씩)
  12 ÷ 2 = 6회 (각 이미지 6번씩)
  12 ÷ 1 = 12회 (동일 이미지 12번)
```

---

## 🎨 시각적 효과로 다양성 확보

### 동일 이미지 재사용 시 문제
```
문제: 같은 이미지가 반복되면 지루할 수 있음
```

### 해결책: Ken Burns 효과
```javascript
// videoRenderer.js에서 이미지 효과 적용

효과 옵션:
  - zoomIn: 이미지 확대
  - zoomOut: 이미지 축소
  - panLeft: 좌측 이동
  - panRight: 우측 이동
  - panUp: 상단 이동
  - panDown: 하단 이동

결과:
  동일 이미지라도 매번 다른 시각적 효과로 다양성 확보 ✅
```

---

## 📊 이미지 수별 권장 사항

| 이미지 수 | 12장면 충족 | 권장도 | 비고 |
|---------|----------|--------|------|
| 12개 이상 | ✅ | ⭐⭐⭐⭐⭐ | 완벽! 순환 불필요 |
| 6개 | ✅ | ⭐⭐⭐⭐ | 좋음 (2번 반복) |
| 4개 | ✅ | ⭐⭐⭐ | 괜찮음 (3번 반복) |
| 3개 | ✅ | ⭐⭐ | 가능 (4번 반복) |
| 2개 | ⚠️ | ⭐ | 최소 (6번 반복) |
| 1개 | ⚠️ | ⚠️ | 비권장 (12번 동일) |

**권장**: 최소 3-6개 이미지 선택

---

## 💡 실전 팁

### 1. 이미지 선택 전략
```
✅ 다양한 각도의 이미지 선택
✅ 컬러/톤이 다른 이미지 조합
✅ 클로즈업과 풀샷 혼합
✅ 제품/인물/풍경 다양화
```

### 2. 순환 패턴 최적화
```
6개 이미지 (1,2,3,4,5,6,1,2,3,4,5,6):
  ✅ 가장 이상적인 패턴
  ✅ 각 이미지 2번씩 균등 사용
  ✅ 시청자가 반복을 거의 눈치채지 못함
```

### 3. 나레이션-이미지 매칭
```
전략: 관련성 높은 나레이션과 이미지 짝짓기
  
  나레이션 1-6: 이미지 1-6 (초기 설정)
  나레이션 7-12: 이미지 1-6 반복
  
  → 같은 주제의 나레이션에 같은 이미지 재사용 시 자연스러움 ✅
```

---

## 🎯 최종 결과

### 30초 이상 보장
```
최소 이미지: 1개
장면 수: 12개
Duration: 2.5-4초/장면
총 길이: 30-48초

결론: 이미지가 1개만 있어도 30초 영상 생성 가능! ✅
```

### 품질 보장
```
✅ 10-15자 짧은 나레이션
✅ 1줄 자막 (가독성 우수)
✅ 음성-자막 완벽 동기화
✅ 12개 장면 (풍부한 콘텐츠)
✅ 30-48초 (유튜브 쇼츠 최적)
✅ 이미지 순환 (부족해도 OK)
✅ Ken Burns 효과 (시각적 다양성)
```

---

## 🧪 테스트 시나리오

### 테스트 1: 6개 이미지
```
1. 블로그 URL 입력
2. 이미지 6개 선택
3. 스크립트 생성
4. 확인:
   □ 장면: 12개
   □ 패턴: 1,2,3,4,5,6,1,2,3,4,5,6
   □ 총 길이: 30초 이상
```

### 테스트 2: 3개 이미지
```
1. 블로그 URL 입력
2. 이미지 3개 선택
3. 스크립트 생성
4. 확인:
   □ 장면: 12개
   □ 패턴: 1,2,3,1,2,3,1,2,3,1,2,3
   □ 총 길이: 30초 이상
```

---

## 📦 Git Commit

- **Commit**: `fcba8ba` - "feat: Add image cycling for 12-scene videos with limited images"

---

## 📚 관련 파일

- `backend/src/routes/script.js` - 이미지 순환 로직 구현
- `IMAGE_CYCLING_GUIDE.md` - 이미지 순환 완전 가이드 (현재 파일)
- `30_SECOND_SHORTS_GUIDE.md` - 30초 이상 영상 가이드

---

## ✅ 결론

**이미지가 부족해도 문제없습니다!**

- 🔄 **자동 순환**: 이미지 부족 시 자동으로 반복 사용
- 📐 **균등 분배**: Modulo 연산으로 공평하게 배치
- 🎯 **30초 보장**: 이미지 1개라도 30초 이상 영상 생성
- 🎨 **시각적 다양성**: Ken Burns 효과로 반복 느낌 최소화
- 💰 **비용 동일**: ₩29 (이미지 수와 무관)

---

**생성일**: 2024-12-22  
**작성자**: AI Assistant  
**버전**: 1.0 (이미지 순환 시스템)
