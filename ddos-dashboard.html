<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ›¡ï¸ NeuralGrid DDoS Defense - Multi Server Dashboard</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ef4444;
            --secondary: #f59e0b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1e1b4b 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.3);
        }

        header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .server-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .server-card {
            background: var(--bg-card);
            padding: 25px;
            border-radius: 12px;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .server-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--success) 0%, var(--primary) 100%);
        }

        .server-card.offline::before {
            background: var(--danger);
        }

        .server-card.local::before {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        .server-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-color: var(--success);
        }

        .server-card.offline:hover {
            border-color: var(--danger);
        }

        .server-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .server-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .server-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .server-status.online {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .server-status.offline {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .server-info {
            margin: 15px 0;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .info-value {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .info-value.good {
            color: var(--success);
        }

        .info-value.warning {
            color: var(--warning);
        }

        .info-value.danger {
            color: var(--danger);
        }

        .server-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            flex: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .summary-section {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 2px solid var(--border);
        }

        .summary-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .summary-item {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 10px 0;
        }

        .summary-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .no-servers {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .no-servers h2 {
            font-size: 2rem;
            margin-bottom: 20px;
        }

        .no-servers p {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: var(--text-secondary);
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 8px;
        }

        .badge-local {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .badge-remote {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ›¡ï¸ NeuralGrid DDoS Defense</h1>
            <p>Multi-Server Real-time Monitoring Dashboard</p>
        </header>

        <div class="summary-section">
            <h2 class="summary-title">ğŸ“Š ì „ì²´ í†µê³„</h2>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-label">ì´ ì„œë²„ ìˆ˜</div>
                    <div class="summary-value" id="total-servers">0</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">ì˜¨ë¼ì¸ ì„œë²„</div>
                    <div class="summary-value" style="color: var(--success)" id="online-servers">0</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">ì „ì²´ íŠ¸ë˜í”½</div>
                    <div class="summary-value" id="total-traffic">0</div>
                    <div class="summary-label">req/s</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">ì°¨ë‹¨ëœ IP</div>
                    <div class="summary-value" style="color: var(--danger)" id="total-blocked">0</div>
                </div>
            </div>
        </div>

        <h2 style="margin-bottom: 20px; font-size: 1.8rem;">ğŸ–¥ï¸ ì„œë²„ í˜„í™©</h2>
        
        <div id="loading" class="loading pulse">
            ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
        </div>

        <div id="servers-container" class="server-grid" style="display: none;">
            <!-- ì„œë²„ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>

        <div id="no-servers" class="no-servers" style="display: none;">
            <h2>ğŸ“­ ë“±ë¡ëœ ì„œë²„ê°€ ì—†ìŠµë‹ˆë‹¤</h2>
            <p>ë‹¤ë¥¸ ì„œë²„ì— Agentë¥¼ ì„¤ì¹˜í•˜ì—¬ ëª¨ë‹ˆí„°ë§ì„ ì‹œì‘í•˜ì„¸ìš”.</p>
            <p><strong>ì„¤ì¹˜ ëª…ë ¹ì–´:</strong></p>
            <p><code>curl -fsSL https://ddos.neuralgrid.kr/install.sh | sudo bash</code></p>
        </div>
    </div>

    <script>
        let servers = [];

        // ì„œë²„ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        async function fetchServers() {
            try {
                const response = await fetch('/api/servers');
                servers = await response.json();
                updateUI();
            } catch (error) {
                console.error('ì„œë²„ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('loading').textContent = 'âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨';
            }
        }

        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            const loading = document.getElementById('loading');
            const container = document.getElementById('servers-container');
            const noServers = document.getElementById('no-servers');

            loading.style.display = 'none';

            if (servers.length === 0) {
                noServers.style.display = 'block';
                container.style.display = 'none';
                return;
            }

            noServers.style.display = 'none';
            container.style.display = 'grid';

            // í†µê³„ ê³„ì‚°
            const onlineServers = servers.filter(s => s.isOnline).length;
            const totalTraffic = servers.reduce((sum, s) => sum + (s.traffic?.requestsPerSecond || 0), 0);
            const totalBlocked = servers.reduce((sum, s) => sum + (s.blockedIPs?.count || 0), 0);

            document.getElementById('total-servers').textContent = servers.length;
            document.getElementById('online-servers').textContent = onlineServers;
            document.getElementById('total-traffic').textContent = totalTraffic;
            document.getElementById('total-blocked').textContent = totalBlocked;

            // ì„œë²„ ì¹´ë“œ ìƒì„±
            container.innerHTML = servers.map(server => createServerCard(server)).join('');
        }

        // ì„œë²„ ì¹´ë“œ HTML ìƒì„±
        function createServerCard(server) {
            const isOnline = server.isOnline;
            const traffic = server.traffic || {};
            const system = server.systemStatus || {};
            const blocked = server.blockedIPs || {};

            const statusClass = isOnline ? 'online' : 'offline';
            const statusText = isOnline ? 'ğŸŸ¢ ì˜¨ë¼ì¸' : 'ğŸ”´ ì˜¤í”„ë¼ì¸';
            const typeClass = server.type === 'local' ? 'local' : '';
            const typeBadge = server.type === 'local' 
                ? '<span class="badge badge-local">LOCAL</span>' 
                : '<span class="badge badge-remote">REMOTE</span>';

            const reqPerSec = traffic.requestsPerSecond || 0;
            const normalTraffic = traffic.normalTraffic || 0;
            const blockedTraffic = traffic.blockedTraffic || 0;
            const load = system.load || 0;
            const memory = system.memory || 0;
            const blockedCount = blocked.count || 0;

            // ìƒ‰ìƒ ê²°ì •
            const loadClass = load > 2 ? 'danger' : load > 1 ? 'warning' : 'good';
            const memoryClass = memory > 80 ? 'danger' : memory > 60 ? 'warning' : 'good';

            return `
                <div class="server-card ${typeClass} ${statusClass}">
                    <div class="server-header">
                        <div>
                            <div class="server-name">${server.name}</div>
                            <small style="color: var(--text-secondary)">${server.ip}</small>
                            ${typeBadge}
                        </div>
                        <div class="server-status ${statusClass}">${statusText}</div>
                    </div>
                    
                    <div class="server-info">
                        <div class="info-row">
                            <span class="info-label">íŠ¸ë˜í”½</span>
                            <span class="info-value">${reqPerSec} req/s</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ì •ìƒ / ì°¨ë‹¨</span>
                            <span class="info-value">
                                <span class="good">${normalTraffic}</span> / 
                                <span class="danger">${blockedTraffic}</span>
                            </span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ì°¨ë‹¨ëœ IP</span>
                            <span class="info-value danger">${blockedCount}ê°œ</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">CPU ë¶€í•˜</span>
                            <span class="info-value ${loadClass}">${load.toFixed(2)}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ë©”ëª¨ë¦¬</span>
                            <span class="info-value ${memoryClass}">${memory.toFixed(1)}%</span>
                        </div>
                    </div>

                    <div class="server-actions">
                        ${server.type === 'local' 
                            ? `<button class="btn btn-primary" onclick="viewDetails('${server.id}')">ìƒì„¸ë³´ê¸°</button>`
                            : `
                            <button class="btn btn-primary" onclick="viewDetails('${server.id}')">ìƒì„¸ë³´ê¸°</button>
                            <button class="btn btn-danger" onclick="removeServer('${server.id}')">ì œê±°</button>
                            `
                        }
                    </div>
                </div>
            `;
        }

        // ìƒì„¸ë³´ê¸°
        function viewDetails(serverId) {
            if (serverId === 'local-115.91.5.140') {
                // ë¡œì»¬ ì„œë²„ëŠ” ê¸°ì¡´ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
                window.location.href = '/dashboard.html';
            } else {
                alert(`${serverId} ì„œë²„ì˜ ìƒì„¸ ì •ë³´\n\n(ì¶”í›„ êµ¬í˜„ ì˜ˆì •)`);
            }
        }

        // ì„œë²„ ì œê±°
        async function removeServer(serverId) {
            if (!confirm('ì´ ì„œë²„ë¥¼ ëª©ë¡ì—ì„œ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                const response = await fetch(`/api/server/${serverId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('ì„œë²„ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    fetchServers();
                } else {
                    alert('ì„œë²„ ì œê±° ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ì„œë²„ ì œê±° ì˜¤ë¥˜:', error);
                alert('ì„œë²„ ì œê±° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // 1ì´ˆë§ˆë‹¤ ë°ì´í„° ê°±ì‹ 
        setInterval(fetchServers, 1000);

        // ì´ˆê¸° ë¡œë“œ
        fetchServers();
    </script>
</body>
</html>
