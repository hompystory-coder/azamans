# 🎵 배경음악 볼륨 조절 기능 업데이트

## ✅ 완료된 작업

### 🎯 **기능 개선**
배경음악 볼륨을 사용자가 설정한 값에 따라 동적으로 적용하도록 개선했습니다.

---

## 🎨 **사용 방법**

### 1. **비디오 페이지 접속**
```
https://shorts.neuralgrid.kr/video
```

### 2. **배경 음악 설정**

#### ① 배경 음악 활성화
- "배경 음악" 섹션의 토글 스위치를 켭니다 ✅

#### ② 음악 파일 업로드
- "음악 파일 업로드" 버튼 클릭
- MP3, WAV 등 오디오 파일 선택
- 미리듣기로 확인 가능 🎧

#### ③ 볼륨 조절
- **슬라이더로 볼륨 조절**: 0% ~ 100%
- **실시간 표시**: 현재 볼륨 퍼센트 표시
- **자동 저장**: 500ms 후 자동으로 저장됨 💾

### 3. **실시간 저장 확인**
- 볼륨 조절 시 "저장됨" 배지가 2초간 표시됩니다 ✅
- 페이지 새로고침 후에도 설정이 유지됩니다

---

## 🔧 **기술적 세부사항**

### 🎚️ **볼륨 적용 방식**

#### 1. **음성이 있는 경우** (나레이션 + 배경음악)
```javascript
voice: 100% (고정)
bgMusic: 사용자 설정값 (예: 30%)
```
- 나레이션은 항상 100% 볼륨
- 배경음악은 사용자가 설정한 볼륨으로 믹싱

#### 2. **음성이 없는 경우** (배경음악만)
```javascript
bgMusic: 설정값 × 1.5 (최대 100%)
```
- 배경음악만 있을 때는 볼륨 1.5배 증폭
- 최대 100%까지만 증폭 (과포화 방지)

### 📝 **코드 변경 내용**

#### **이전** (하드코딩)
```javascript
// 항상 30% 고정
'[1:a]volume=0.3[music]'
```

#### **현재** (동적 적용)
```javascript
// 사용자 설정값 적용
const bgMusicVolume = settings.bgMusic.volume || 0.3;
`[1:a]volume=${bgMusicVolume}[music]`
```

### 💾 **실시간 저장**

#### 저장 시점
- 볼륨 슬라이더 변경 후 **500ms 디바운스**
- 음악 파일 변경 시 즉시
- 토글 활성화/비활성화 시 즉시

#### 저장 위치
1. **LocalStorage**: 설정값 (enabled, volume)
2. **IndexedDB**: 음악 파일 (50MB 제한)

#### 자동 복구
```javascript
// 페이지 로드 시 자동으로 설정 복구
useEffect(() => {
  loadSettings(); // localStorage + IndexedDB
}, []);
```

---

## 🎬 **비디오 생성 시 적용**

### FFmpeg 명령어 예시

#### 음성 + 배경음악 (볼륨 40%)
```bash
ffmpeg -i input.mp4 -i bgmusic.mp3 \
  -filter_complex "[0:a]volume=1.0[voice];[1:a]volume=0.4[music];[voice][music]amix=inputs=2[aout]" \
  -map 0:v -map [aout] output.mp4
```

#### 배경음악만 (볼륨 40% → 60% 증폭)
```bash
ffmpeg -i input.mp4 -i bgmusic.mp3 \
  -filter_complex "[1:a]volume=0.6[aout]" \
  -map 0:v -map [aout] output.mp4
```

---

## 📊 **테스트 시나리오**

### ✅ **테스트 1: 볼륨 변경**
1. 배경음악 활성화
2. 음악 파일 업로드
3. 볼륨을 20% → 50% → 80%로 변경
4. 각 단계에서 "저장됨" 표시 확인 ✅
5. 페이지 새로고침 후 80% 유지 확인 ✅

### ✅ **테스트 2: 비디오 생성**
1. 볼륨 30% 설정
2. 비디오 생성 실행
3. 백엔드 로그 확인:
   ```
   🎵 배경 음악 파일 저장: /tmp/uploads/music/xxx.mp3
   배경 음악 볼륨: 30%
   ```
4. 생성된 비디오 재생하여 볼륨 확인 ✅

### ✅ **테스트 3: 설정 유지**
1. 볼륨 50%, 음악 파일 업로드
2. 다른 페이지로 이동
3. 다시 비디오 페이지 접속
4. 설정 유지 확인 (볼륨 50%, 파일 유지) ✅

---

## 🎯 **권장 볼륨 설정**

### 📢 **콘텐츠 유형별 추천**

| 콘텐츠 유형 | 나레이션 | 배경음악 볼륨 | 설명 |
|-----------|---------|-------------|------|
| **뉴스/정보** | ✅ | 20-30% | 나레이션 집중 |
| **브이로그** | ✅ | 30-40% | 균형잡힌 믹싱 |
| **감성 영상** | ❌ | 70-100% | 음악 중심 |
| **ASMR** | ✅ | 10-20% | 나레이션 우선 |
| **광고/홍보** | ✅ | 40-50% | 활기찬 느낌 |

### 🎵 **음악 장르별 추천**

| 음악 장르 | 권장 볼륨 | 이유 |
|---------|----------|------|
| **클래식** | 25-35% | 부드러운 분위기 |
| **재즈** | 30-40% | 편안한 백그라운드 |
| **일렉트로닉** | 20-30% | 강렬한 비트 |
| **로파이** | 35-45% | 집중 유지 |
| **팝송** | 25-35% | 명확한 가사 |

---

## ⚠️ **주의사항**

### 🔊 **볼륨 설정 팁**

1. **너무 높은 볼륨 (70% 이상)**
   - ❌ 나레이션이 잘 안 들림
   - ❌ 음악이 시끄러움
   - ✅ 음악만 있는 경우 적합

2. **너무 낮은 볼륨 (10% 이하)**
   - ❌ 배경음악이 거의 안 들림
   - ✅ ASMR이나 조용한 콘텐츠에 적합

3. **권장 범위: 20-40%**
   - ✅ 나레이션과 음악의 균형
   - ✅ 대부분의 콘텐츠에 적합

### 💾 **파일 관리**

- **최대 파일 크기**: 50MB
- **지원 형식**: MP3, WAV, AAC, OGG
- **저장 공간**: 브라우저 IndexedDB (무제한)
- **자동 정리**: 파일 변경 시 이전 파일 삭제

---

## 🚀 **배포 정보**

### Git Commit
```
Commit: 102e35e
Message: feat: Apply dynamic background music volume from user settings
```

### 배포 시간
- Backend: 재시작 완료 ✅
- Frontend: 변경 없음 (기존 기능 활용)

### 테스트 URL
```
https://shorts.neuralgrid.kr/video
```

---

## 💰 **비용 정보**

### 쇼츠 1개당 비용
```
크롤링:        ₩0  (로컬)
스크립트:      ₩0  (템플릿 기반)
음성 생성:     ₩29 (Minimax TTS)
비디오 렌더링:  ₩0  (FFmpeg 로컬)
배경음악 추가:  ₩0  (로컬 처리)
────────────────────
총합:         ₩29
```

배경음악 기능은 **완전 무료**입니다! 🎉

---

## 📞 **문의 및 피드백**

배경음악 볼륨 기능에 대한 문의사항이나 개선 제안이 있으시면 알려주세요!

---

*최종 업데이트: 2024-12-22*
*작성자: AI Assistant*
*관련 파일: backend/src/utils/videoRenderer.js, frontend/src/pages/VideoPage.jsx*
